"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tab=exports.Tabs=void 0;var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),Tabs=exports.Tabs=function(e){function t(){var e,o,a,n;_classCallCheck(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return o=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),a.dragTarget=null,a.mouseMoveHandler=a.handleMouseMove.bind(a),a.mouseUpHandler=a.handleMouseUp.bind(a),a.tooltipTimeout=null,a.singleTabWidth=0,a.tabTotal=0,n=o,_possibleConstructorReturn(a,n)}return _inherits(t,e),_createClass(t,[{key:"switchTab",value:function(e){this.props.onTabSwitch(e)}},{key:"handleMouseDown",value:function(e){this.dragTarget={target:e.currentTarget,x:e.currentTarget.offsetLeft,left:e.currentTarget.offsetLeft+"px",mouseX:e.pageX,index:this.getIndexByLeft(e.currentTarget.offsetLeft)}}},{key:"handleMouseUp",value:function(){this.dragTarget=null,this.forceUpdate()}},{key:"handleMouseMove",value:function(e){if(this.dragTarget){e.preventDefault(),e.stopPropagation();var t=this.dragTarget,o=(t.target,this.refs.tabs.offsetWidth/100),a=o+o*this.singleTabWidth*(this.tabTotal-1),n=t.x+e.pageX-t.mouseX;n<o&&(n=o),n>a&&(n=a);var r=this.getIndexByLeft(n);if(r!=t.index){var i=r,s=t.index;this.props.onTabPositionChange(i,s),t.index=r}t.left=n+"px",this.hideTooltip(),this.forceUpdate()}}},{key:"handleClose",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.props.onTabClose(e)}},{key:"handleAdd",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onTabAdd()}},{key:"getLeftByIndex",value:function(e){return 1+this.singleTabWidth*e}},{key:"getIndexByLeft",value:function(e){var t=this.refs.tabs.offsetWidth/100;return Math.round((e-t)/(t*this.singleTabWidth))}},{key:"showTooltip",value:function(e){var t=this,o=e.currentTarget.getElementsByClassName("text")[0].innerText,a=e.currentTarget.offsetLeft;this.tooltipTimeout||(this.tooltipTimeout=window.setTimeout(function(){t.refs.tooltip.innerText=o,t.refs.tooltip.style.display="block",t.refs.tooltip.style.left=a+30+"px"},800))}},{key:"hideTooltip",value:function(){window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null,this.refs.tooltip.style.display="none"}},{key:"componentDidMount",value:function(){this.props.draggable&&(window.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("mouseup",this.mouseUpHandler))}},{key:"componentWillUnmount",value:function(){this.props.draggable&&(window.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("mouseup",this.mouseUpHandler))}},{key:"render",value:function(){var e=this,t=this.props;this.tabTotal=t.children.length,this.singleTabWidth=98/this.tabTotal;var o=t.children.map(function(o,a){var n={},r=a,i=null;return o.props.icon&&(i="string"==typeof o.props.icon?_react2.default.createElement(TabIcon,{type:o.props.icon}):o.props.icon),n.zIndex=e.tabTotal-r,n.left=e.getLeftByIndex(r)+"%",n.width=e.singleTabWidth+"%",e.dragTarget&&e.dragTarget.index==r&&(n.left=e.dragTarget.left),_react2.default.createElement("div",{key:a,className:"tab-button"+(t.active==a?" active":""),style:n,onClick:e.switchTab.bind(e,a),onMouseDown:e.handleMouseDown.bind(e),onMouseEnter:e.showTooltip.bind(e),onMouseLeave:e.hideTooltip.bind(e)},_react2.default.createElement("div",{className:"tab",style:e.props.color?{borderColor:e.props.color}:null}),_react2.default.createElement("div",{className:"text"+(o.props.showClose?" with-close":"")},i,o.props.title),o.props.showClose?_react2.default.createElement("div",{className:"close",onClick:e.handleClose.bind(e,a)}):null)}),a=t.children.map(function(e,o){return t.active!=o?null:_react2.default.createElement("div",{className:"panel active",key:"panel-"+o},e)});return _react2.default.createElement("div",{className:"r-a-t"},_react2.default.createElement("div",{className:"tab-wrapper"+(this.props.showAdd?" with-add":""),ref:"tabs"},o),this.props.showAdd?_react2.default.createElement("div",{className:"add-wrapper",onClick:this.handleAdd.bind(this)}):null,_react2.default.createElement("div",{className:"panel-wrapper",style:this.props.color?{borderColor:this.props.color}:null},a),_react2.default.createElement("div",{className:"tooltip",ref:"tooltip"}))}}]),t}(_react.Component),Tab=function(e){var t=e.children;return _react2.default.createElement("div",null,t)},TabIcon=function(e){var t=e.type;return _react2.default.createElement("div",{className:"icon "+t},"loading"==t?_react2.default.createElement("div",{className:"mask"}):null)};exports.default=Tabs,exports.Tab=Tab;