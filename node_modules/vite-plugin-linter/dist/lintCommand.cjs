#!/usr/bin/env node
'use strict';

const vite = require('vite');
const linterPluginBuild = require('./shared/vite-plugin-linter.b8fe9d0b.cjs');
require('./lintWorkerThread.cjs');
require('url');
require('worker_threads');
require('fs');
require('path');

async function lint() {
  const config = await vite.resolveConfig({}, "build");
  const plugin = config.plugins.find((p) => p.name === linterPluginBuild.buildPluginName);
  if (!plugin) {
    throw new Error(`Could not find plugin ${linterPluginBuild.buildPluginName}`);
  }
  const outputLines = await plugin.lintFolder(
    process.cwd()
  );
  if (outputLines.length > 0) {
    for (const output of outputLines) {
      console.warn(output);
    }
    console.error("Linting failed, see above output");
    process.exit(1);
  }
}
global.vitePluginLinter = { mode: "lintCommand" };
lint();
